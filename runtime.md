> [runtime.cpp](https://github.com/cocaine/cocaine-core/blob/master/src/runtime/runtime.cpp)

Здесь начинается жизненный цикл кокаина. Выполняются следующие действия:

* инспектируются опции, указанные при запуске
* читается из файла конфигурация
* при необходимости производится переход в фоновый режим
* инициализируется контекст исполнения
* настраиваются сигналы
* запускается основной цикл исполнения
* выход из программы происходит по сигналам `SIGINT`, `SIGTERM` или `SIGQUIT`

Итак, строки `171-286` - описание точки входа. Разберём по строкам:

* `175-193`: установка опций по умолчанию
* `195-199`: если запуск выполнен с опцией `help` выводим помощь и заканчиваем выполнение
* `201-210`: если запуск выполнен с опцией `version`, выводим версию и заканчиваем выполнение
* `214-217`: требуем, чтобы при запуске был указан путь к файлу конфигурации
* `223-237`: читаем конфигурацию
* `245-269`: если указана опция `daemonize`, то в `257` уходим в фоновый режим
* `276-281`: создаём контекст выполнения, логи помечать как `core`
* `283`: запуск рантайм

Из описанного выше понятно, что две основных сущности тут - это [контекст](context.md) и рантайм. Рантайм разберём здесь, поскольку он находится в том же файле:

### runtime_t

#### runtime_t()

* `88-95`: На сигналы `SIGINT`, `SIGTERM`, `SIGQUIT` реагировать с помощью метода `terminate`
* `99-129`: Магия с сигналами

#### ~runtime_t()

перед завершением работы все сигналы возвращаются на место

#### void run()

собственно, этот метод и вызывается из основной программы. Состоит из единственного вызова - запустить цикл исполнения

#### void terminate()
вызывается сигналами `SIGINT`, `SIGTERM` и `SIGQUIT` и останавливает цикл исполнения.

От сюда понимаем, что при запуске рантайма (`runtime.run()`) выполняется запуск цикла libev. Выход из этой фунции произойдёт по сигналам `SIGINT`, `SIGTERM` или `SIGQUIT` при вызове метода `terminate`. После чего в `285` произойдёт нормальное (не аварийное) завершение программы.

