> [locator.cpp](https://github.com/cocaine/cocaine-core/blob/master/src/locator.cpp)

Назначение локатора соответсвует его названию. Для аггрегирующей ноды он собирает информацию о других учатниках облака, объединённых мультикаст-группой маршрутизации. Для обычной ноды (а также и для аггрегирующей), он анонсирует себя для локаторов аггрегирующих нод.

### locator_t

#### locator_t(context_t& context, reactor_t& reactor)

Инициализируется сервис локатора в контексте `context`

* `72-83`: Прочитать из хранилища `core` все группы маршрутизации в папках `groups/group` и `groups/active` и добавить их в маршрутизатор
* `86-87`: Если в конфигурации указанна группа маршрутизации, подключиться к группе.

#### void connect()

Подключиться к группе маршрутизации

* `103-136`: Если данная нода аггрегирующая, присоединиться к мультикаст группе и создать аггрегатор (`gateway_t`). При появлении в группе анонса, вызвать метод `on_annonce_event`.
* `138-154`: Аннонсировать себя для локаторов аггрегирующих нод

#### auto resolve(const std::string& name)

Найти сервис или приложение с именем `name` локально или в облаке

* `159`: получить от маршрутизатора имя сервиса
* `160-168`: если сервис существует в локальном контексте, вернуть его
* `171`: если данная нода аггрегирующая, найти сервис с помощью аггрегатора
* иначе вызывается ошибка

#### auto refresh(const std::string& name)

Обновить группу маршрутизации с именем `name` с диска. Если группа с заданным именем на диске не существует, она удаляется из маршрутизатора.

#### void on_announce_event(ev::io&, int)

Вызывается при появлении анонса в мультикаст-группе.

* `327`: прочитать анонс
* `329-335`: пустой анонс является ошибкой
* `337-353`: распаковать анонс и извлечь из него адрес пославшей его ноды
* `355-357`: если данной ноды в списке нод нету, ничего больше не делать
* Далее происходит синхронизация между нодами
